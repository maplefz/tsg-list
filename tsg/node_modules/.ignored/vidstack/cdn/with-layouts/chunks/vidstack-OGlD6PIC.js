import{ai as C,l as u,G as w,i as l,E,D as o,a as g,k as m}from"./vidstack-DgnIG4vb.js";import{g as S}from"./vidstack-BrfKt6q_.js";const k=Symbol(0),B=Symbol(0),x=Symbol(0),O=Symbol(0),_=Symbol(0),$=Symbol(0),F=Symbol(0),a={Db:k,ma:B,Eb:x,Z:O,hb:_,_:$,Mf:F};function f(r,t){return t>=r.startTime&&t<r.endTime}function p(r,t,i){let s=null,e=C();function n(){const h=l(t)?[t]:t,c=r.toArray().find(d=>h.includes(d.kind)&&d.mode==="showing");if(c!==s){if(!c){i(null),s=null;return}c.readyState==2?i(c):(i(null),w(()=>{const d=u(c,"load",()=>{i(c),d()},{once:!0})},e)),s=c}}return n(),u(r,"mode-change",n)}function j(r,t,i){p(r,t,s=>{if(!s){i("");return}const e=()=>{const n=s?.activeCues[0];i(n?.text||"")};e(),u(s,"cue-change",e)})}var b,T,y;class R extends E{constructor(t){super(),this.id="",this.label="",this.language="",this.default=!1,this.Z=!1,this.ua=0,this.U="disabled",this.Nf={},this.$c=[],this.B=[],this.Fb=[],this[y]=0,this[T]=null,this[b]=null;for(const i of Object.keys(t))this[i]=t[i];this.type||(this.type="vtt"),t.content?this._h(t):t.src||(this[a.ma]=2)}static createId(t){return`vds-${t.type}-${t.kind}-${t.src??t.label??"?"}`}get metadata(){return this.Nf}get regions(){return this.$c}get cues(){return this.B}get activeCues(){return this.Fb}get readyState(){return this[a.ma]}get mode(){return this.U}set mode(t){this.setMode(t)}addCue(t,i){let s=0,e=this.B.length;for(s=0;s<e&&!(t.endTime<=this.B[s].startTime);s++);s===e?this.B.push(t):this.B.splice(s,0,t),t instanceof TextTrackCue||this[a._]?.track.addCue(t),this.dispatchEvent(new o("add-cue",{detail:t,trigger:i})),f(t,this.ua)&&this[a.Eb](this.ua,i)}removeCue(t,i){const s=this.B.indexOf(t);if(s>=0){const e=this.Fb.includes(t);this.B.splice(s,1),this[a._]?.track.removeCue(t),this.dispatchEvent(new o("remove-cue",{detail:t,trigger:i})),e&&this[a.Eb](this.ua,i)}}setMode(t,i){this.U!==t&&(this.U=t,t==="disabled"?(this.Fb=[],this.Of()):this.readyState===2?this[a.Eb](this.ua,i):this.Pf(),this.dispatchEvent(new o("mode-change",{detail:this,trigger:i})),this[a.hb]?.())}[(y=a.ma,T=a.hb,b=a._,a.Eb)](t,i){if(this.ua=t,this.mode==="disabled"||!this.B.length)return;const s=[];for(let n=0,h=this.B.length;n<h;n++){const c=this.B[n];f(c,t)&&s.push(c)}let e=s.length!==this.Fb.length;if(!e){for(let n=0;n<s.length;n++)if(!this.Fb.includes(s[n])){e=!0;break}}this.Fb=s,e&&this.Of(i)}[a.Z](){this.Z=!0,this.U!=="disabled"&&this.Pf()}_h(t){import("https://cdn.jsdelivr.net/npm/media-captions@next/dist/prod.js").then(({parseText:i,VTTCue:s,VTTRegion:e})=>{!l(t.content)||t.type==="json"?(this.Qf(t.content,s,e),this.readyState!==3&&this.Ga()):i(t.content,{type:t.type}).then(({cues:n,regions:h})=>{this.B=n,this.$c=h,this.Ga()})})}async Pf(){if(!(!this.Z||this[a.ma]>0)){if(this[a.ma]=1,this.dispatchEvent(new o("load-start")),!this.src){this.Ga();return}try{const{parseResponse:t,VTTCue:i,VTTRegion:s}=await import("https://cdn.jsdelivr.net/npm/media-captions@next/dist/prod.js"),e=this[a.Db]?.(),n=fetch(this.src,{headers:this.type==="json"?{"Content-Type":"application/json"}:void 0,credentials:S(e)});if(this.type==="json")this.Qf(await(await n).text(),i,s);else{const{errors:h,metadata:c,regions:d,cues:v}=await t(n,{type:this.type,encoding:this.encoding});if(h[0]?.code===0)throw h[0];this.Nf=c,this.$c=d,this.B=v}this.Ga()}catch(t){this.Rf(t)}}}Ga(){if(this[a.ma]=2,!this.src||this.type!=="vtt"){const i=this[a._];if(i&&!i.managed)for(const s of this.B)i.track.addCue(s)}const t=new o("load");this[a.Eb](this.ua,t),this.dispatchEvent(t)}Rf(t){this[a.ma]=3,this.dispatchEvent(new o("error",{detail:t}))}Qf(t,i,s){try{const{regions:e,cues:n}=A(t,i,s);this.$c=e,this.B=n}catch(e){this.Rf(e)}}Of(t){this.dispatchEvent(new o("cue-change",{trigger:t}))}}const G=/captions|subtitles/;function N(r){return G.test(r.kind)}function A(r,t,i){const s=l(r)?JSON.parse(r):r;let e=[],n=[];return s.regions&&i&&(e=s.regions.map(h=>Object.assign(new i,h))),(s.cues||g(s))&&(n=(g(s)?s:s.cues).filter(h=>m(h.startTime)&&m(h.endTime)).map(h=>Object.assign(new t(0,0,""),h))),{regions:e,cues:n}}export{a as T,R as a,j as b,f as c,N as i,p as w};
