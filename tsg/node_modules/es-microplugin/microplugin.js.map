{"version":3,"file":"microplugin.js","sources":["src/index.js"],"sourcesContent":["/**\n * microplugin.js\n * Copyright (c) 2013 Brian Reavis & contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this\n * file except in compliance with the License. You may obtain a copy of the License at:\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF\n * ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n *\n * @author Brian Reavis <brian@thirdroute.com>\n */\n\nimport isArray from 'es-is/array';\n\nconst MicroPlugin = {};\n\nMicroPlugin.mixin = function(Interface) {\n    Interface.plugins = {};\n\n    /**\n     * Initializes the listed plugins (with options).\n     * Acceptable formats:\n     *\n     * List (without options):\n     *   ['a', 'b', 'c']\n     *\n     * List (with options):\n     *   [{'name': 'a', options: {}}, {'name': 'b', options: {}}]\n     *\n     * Hash (with options):\n     *   {'a': { ... }, 'b': { ... }, 'c': { ... }}\n     *\n     * @param {mixed} plugins\n     */\n    Interface.prototype.initializePlugins = function(plugins) {\n        var i, n, key;\n        var self  = this;\n        var queue = [];\n\n        self.plugins = {\n            names     : [],\n            settings  : {},\n            requested : {},\n            loaded    : {}\n        };\n\n        if (isArray(plugins)) {\n            for (i = 0, n = plugins.length; i < n; i++) {\n                if (typeof plugins[i] === 'string') {\n                    queue.push(plugins[i]);\n                } else {\n                    self.plugins.settings[plugins[i].name] = plugins[i].options;\n                    queue.push(plugins[i].name);\n                }\n            }\n        } else if (plugins) {\n            for (key in plugins) {\n                if (plugins.hasOwnProperty(key)) {\n                    self.plugins.settings[key] = plugins[key];\n                    queue.push(key);\n                }\n            }\n        }\n\n        while (queue.length) {\n            self.require(queue.shift());\n        }\n    };\n\n    Interface.prototype.loadPlugin = function(name) {\n        var self    = this;\n        var plugins = self.plugins;\n        var plugin  = Interface.plugins[name];\n\n        if (!Interface.plugins.hasOwnProperty(name)) {\n            throw new Error('Unable to find \"' +  name + '\" plugin');\n        }\n\n        plugins.requested[name] = true;\n        plugins.loaded[name] = plugin.fn.apply(self, [self.plugins.settings[name] || {}]);\n        plugins.names.push(name);\n    };\n\n    /**\n     * Initializes a plugin.\n     *\n     * @param {string} name\n     */\n    Interface.prototype.require = function(name) {\n        var self = this;\n        var plugins = self.plugins;\n\n        if (!self.plugins.loaded.hasOwnProperty(name)) {\n            if (plugins.requested[name]) {\n                throw new Error('Plugin has circular dependency (\"' + name + '\")');\n            }\n            self.loadPlugin(name);\n        }\n\n        return plugins.loaded[name];\n    };\n\n    /**\n     * Registers a plugin.\n     *\n     * @param {string} name\n     * @param {function} fn\n     */\n    Interface.define = function(name, fn) {\n        Interface.plugins[name] = {\n            'name' : name,\n            'fn'   : fn\n        };\n    };\n};\n\nexport default MicroPlugin;\n"],"names":[],"mappings":"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"}